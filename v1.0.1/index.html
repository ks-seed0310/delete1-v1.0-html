<!doctype html>
<html lang=ja>
<head>
<meta charset=utf-8>
<title>文字列変換プログラム　V1.0.1</title>
<style>
  #customWrap { display:none; }
  textarea { width: 100%; }
  #consolearea h1 { font-size: 1.2em; }
</style>
</head>
<body>
<h1>半角/全角スペース/改行 除去プログラム</h1>

<!-- チェックボックス -->
<label><input type="checkbox" id="removeHalf"> 半角スペースを消す</label>
<label><input type="checkbox" id="removeFull"> 全角スペースを消す</label>
<label><input type="checkbox" id="removeLine"> 改行を消す</label>
<label><input type="checkbox" id="removeCustom"> カスタム文字を消す</label>

<!-- カスタム文字入力 -->
<div id="customWrap">
  <textarea id="customText" rows="2" placeholder=`あ
    い
    う
    え
    お
    このように消したい文字列を改行で入力`></textarea>
</div>

<!-- 入力・出力・ボタン -->
<button id="startbutton" onclick="start()">スタート!</button>
<br>
<textarea id="textarea" rows="10" cols="150">ここに文字列を入力</textarea>
<br>
<div id="consolearea"><h1>初期化/準備完了。ここにログが出ます。</h1></div>
<br>
<textarea id="outputarea" rows="10" cols="150" disabled=true>ここに出力されます</textarea>

<script>
// 要素取得
const textarea = document.getElementById("textarea");
const outputarea = document.getElementById("outputarea");
const consolearea = document.getElementById("consolearea");
const startbutton = document.getElementById("startbutton");

const removeHalf = document.getElementById('removeHalf');
const removeFull = document.getElementById('removeFull');
const removeLine = document.getElementById('removeLine');
const removeCustom = document.getElementById('removeCustom');
const customWrap = document.getElementById('customWrap');
const customText = document.getElementById('customText');

// sleep 関数
function sleep(ms){ return new Promise(resolve => setTimeout(resolve, ms)); }

// カスタム文字チェックボックスで textarea 表示/非表示
removeCustom.addEventListener('change', () => {
  customWrap.style.display = removeCustom.checked ? 'block' : 'none';
});

// メイン処理
async function start(){
    if(!confirm("開始していいですか?開始した場合、入力エリアと出力エリアの文字列が消去されます。")){
        textarea.disabled = false;
        arealog("cancel");
        await sleep(2000)
        arealog("home")
        return;
    }

    textarea.disabled = true;
    startbutton.disabled = true;

    arealog("start");
    await sleep(1000);

    await runscript();
}

async function runscript(){
    arealog("run");
    await sleep(500)
    outputarea.value = "変換中..."
    await sleep(500)

    let textValue = textarea.value;

    // チェック状態に応じた処理
    if(removeHalf.checked) textValue = textValue.replace(/ /g,"");
    if(removeFull.checked) textValue = textValue.replace(/　/g,"");
    if(removeLine.checked) textValue = textValue.replace(/\n/g,"");
    if(removeCustom.checked){
        const list = customText.value.split("\n").filter(s=>s);
        list.forEach(str => {
            const re = new RegExp(str,"g");
            textValue = textValue.replace(re,"");
        });
    }

    outputarea.value = textValue;

    await sleep(500);
    arealog("runOK");
    textarea.disabled = false;
    startbutton.disabled = false;
}

// ログ表示関数
function arealog(logs){
    if (logs=="start"){ _html_("変換を承諾しました"); }
    if (logs=="cancel"){ _html_("変換をキャンセルしました"); }
    if (logs=="run"){ _html_("現在、変換中..."); }
    if (logs=="runOK"){ _html_("変換が完了しました!!"); }
    if (logs=="home"){ _html_("ここにログが出ます");}
}

function _html_(text){
    consolearea.innerHTML = `<h1>${text}</h1>`;
}
</script>
</body>
</html>
